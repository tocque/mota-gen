# 地图生成器 改

## 流程

从上到下按多级进行生成：

### 地图生成

参数需求: `mapCount: number` 地图数量

这一部分将确定整个地图的情况

#### 楼梯生成

参数需求: `startLoc: [number, number]` 区域首层的下楼梯位置

逐层生成上下楼梯位置

#### 房间生成

按照系数在地图上划出多个不连通区域标记为房间，标记房间周围一圈为墙壁，随机打开墙壁，标记为入口

#### 地图完全生成

将所有房间随机进行连通，不破坏之前标记的墙壁

#### 标记重要房间

随机标记一些房间是重要的，要求这些房间不能是必经之路，越后期的地图此概率越低

另外一些房间可以被标记为难度控制房间，设定为不可破，要求使用难度控制道具进入，或者二破 / 三破

### 道具 - 怪物生成

#### 标记生成位置

参数需求: `items: { normal: number[], valued: numer[], key: number[] }`

道具分为三种等级，例如：

| 类型 | 普通道具 | 高价值 | 关键道具 |
| :-: | :-: | :-: | :-: |
| 钥匙 | 黄钥匙 | 蓝钥匙 | 红钥匙 |
| 宝石 | +1 | +2 | +5 |
| 装备 ||| 剑盾等 |
| 道具 ||| 破墙镐 飞行器 |

1 : 3 : 10 : 20

首先标记所有的道具生成地点

> 尽量标记叶节点为生成位置，对于房间，不生成在入口旁边

#### 怪物

参数需求: `enemies: number[]`

需要按强度给出怪物

越后的地图高强度怪物出现几率越大

难度控制房间中不放置怪物

关键房间不遵守这个概率，始终保持较高概率

#### 生成钥匙 - 门

从下到上 bfs 全楼层，随机放置钥匙，保证 bfs 流程中钥匙数量始终为正

随机散布道具，特别的，关键物品必须放入重要房间中，高价值物品出现的概率小于普通物品

### 生成BOSS层

#### 生成BOSS

参数需求: `initStatus: status[]`

统计所有怪物的经验值，确定是否要在战前进行升级

统计所有的能力，确定 boss 能力的大概值并生成

#### 生成BOSS层

没啥想法，为了简单考虑，此层只有咸鱼门和BOSS

设计为打败BOSS出现上楼梯比较简单

github 头像那种像素生成 作为墙壁？
