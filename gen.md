# 地图生成器 改

## 流程

从上到下按多级进行生成：

### 地图生成

参数需求: `mapCount: number` 地图数量

这一部分将确定整个地图的情况

#### 楼梯生成

参数需求: `startLoc: [number, number]` 区域首层的下楼梯位置

逐层生成上下楼梯位置

#### 房间生成

按照系数在地图上划出多个不连通区域标记为房间，标记房间周围一圈为墙壁，随机打开墙壁，标记为入口

#### 地图完全生成

将所有房间随机进行连通，不破坏之前标记的墙壁

#### 标记房间节点类型

根据房间连接图，房间可能是不同类型的，例如说，房间可能是 起点 / 终点，或者其他叶子，割点，甚至不连通节点。

### 房间布设

#### 怪物

参数需求: `enemies: number[]`

系统会按如下策略生成一系列怪物

```
special: number[] 随机拥有 魔攻 先攻 二连击 坚固 四种属性
hp: number  生命值成长率
atk: number 攻击力成长率
def: number 防御力成长率
```

在生成怪物后作者需要取名并添加怪物素材，并可以对怪物进行微调

随后怪物将输入怪物调参器，在这其中将执行如下步骤：

1. 将所有怪物按顺序分配到每个地图中，例如说
[ 1F, 2F, 2F, 3F, 4F, 5F, 7F ]
2. 根据数值膨胀率算出每个地图的预期角色能力值，通过调节怪物成长度将其损血量固定在一个范围内，目前经验值为一基数基础血瓶，上下浮动20%
3. 计算每个怪在所有地图的预期伤害

#### 布设剑盾

#### 标记生成位置

参数需求: `items: { normal: number[], valued: numer[], key: number[] }`

道具分为三种等级，例如：

| 类型 | 普通道具 | 高价值 | 关键道具 |
| :-: | :-: | :-: | :-: |
| 钥匙 | 黄钥匙 | 蓝钥匙 | 红钥匙 |
| 宝石 | +1 | +2 | +5 |
| 装备 ||| 剑盾等 |
| 道具 ||| 破墙镐 飞行器 |

1 : 3 : 10 : 20

首先标记所有的道具生成地点

> 尽量标记叶节点为生成位置，对于房间，不生成在入口旁边

#### 布设房间

从下到上 bfs 全楼层，随机放置钥匙，保证 bfs 流程中钥匙数量始终为正

随机散布道具，特别的，关键物品必须放入重要房间中，高价值物品出现的概率小于普通物品

### 生成BOSS层

#### 生成BOSS

参数需求: `initStatus: status[]`

统计所有怪物的经验值，确定是否要在战前进行升级

统计所有的能力，确定 boss 能力的大概值并生成

#### 生成BOSS层

没啥想法，为了简单考虑，此层只有咸鱼门和BOSS

设计为打败BOSS出现上楼梯比较简单

github 头像那种像素生成 作为墙壁？
